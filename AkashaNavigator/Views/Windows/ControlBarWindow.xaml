<Window x:Class="AkashaNavigator.Views.Windows.ControlBarWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:AkashaNavigator.ViewModels.Windows"
        Title="ControlBar"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="NoResize"
        Topmost="True"
        ShowInTaskbar="False"
        Height="60"
        SourceInitialized="Window_SourceInitialized">

    <Window.Resources>
        <!-- å¯¼èˆªæŒ‰é’®æ ·å¼ (ControlBar ç‰¹æœ‰æ ·å¼ï¼Œä¿ç•™æœ¬åœ°å®šä¹‰) -->
        <Style x:Key="NavButtonStyle" TargetType="Button">
            <Setter Property="Width" Value="32"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#CCCCCC"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                CornerRadius="4"
                                Padding="4">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#3A3A3A"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#4A4A4A"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="#555555"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- URL åœ°å€æ æ ·å¼ (ControlBar ç‰¹æœ‰æ ·å¼ï¼Œä¿ç•™æœ¬åœ°å®šä¹‰) -->
        <Style x:Key="UrlTextBoxStyle" TargetType="TextBox">
            <Setter Property="Background" Value="#2A2A2A"/>
            <Setter Property="Foreground" Value="#EEEEEE"/>
            <Setter Property="BorderBrush" Value="#3A3A3A"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="CaretBrush" Value="#EEEEEE"/>
            <Setter Property="SelectionBrush" Value="#0078D4"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4">
                            <ScrollViewer x:Name="PART_ContentHost"
                                          Focusable="False"
                                          VerticalScrollBarVisibility="Hidden"
                                          HorizontalScrollBarVisibility="Hidden"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="BorderBrush" Value="#505050"/>
                            </Trigger>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter TargetName="border" Property="BorderBrush" Value="#0078D4"/>
                            </Trigger>
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsFocused" Value="True"/>
                                    <Condition Property="IsMouseOver" Value="True"/>
                                </MultiTrigger.Conditions>
                                <Setter TargetName="border" Property="BorderBrush" Value="#1A8FE8"/>
                            </MultiTrigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- DarkContextMenuStyle, DarkMenuItemStyle, DarkSeparatorStyle ä½¿ç”¨å…¨å±€æ ·å¼ (DialogStyles.xaml) -->
    </Window.Resources>

    <Grid Background="Transparent">
        <!-- è§¦å‘ç»†çº¿ï¼ˆä¸Žå±•å¼€åŽçš„æ‹–åŠ¨æ¨ªçº¿ä½ç½®ã€æ ·å¼ä¸€è‡´ï¼‰ -->
        <Border x:Name="TriggerLineBorder"
                Width="80"
                Height="4"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Background="#909090"
                CornerRadius="2"
                Visibility="Collapsed"
                Cursor="Hand"/>

        <!-- ä¸»å®¹å™¨ï¼ˆé»˜è®¤éšè—ï¼Œå±•å¼€æ—¶æ‰æ˜¾ç¤ºï¼‰ -->
        <Border x:Name="MainBorder"
                Background="#E0202020"
                BorderBrush="#3A3A3A"
                BorderThickness="1"
                CornerRadius="6"
                Margin="4"
                Visibility="Collapsed">

        <Border.Effect>
            <DropShadowEffect BlurRadius="8"
                              ShadowDepth="2"
                              Opacity="0.5"
                              Color="Black"/>
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="5"/>   <!-- æ‹–åŠ¨æ¡ -->
                <RowDefinition Height="*"/>   <!-- å†…å®¹åŒº -->
            </Grid.RowDefinitions>

            <!-- é¡¶éƒ¨æ‹–åŠ¨æ¡ -->
            <Border x:Name="DragBar"
                    Grid.Row="0"
                    Background="Transparent"
                    Cursor="SizeAll"
                    MouseLeftButtonDown="DragBar_MouseLeftButtonDown"/>

            <!-- æ‹–åŠ¨æ¡æŒ‡ç¤ºå™¨ï¼ˆå±…ä¸­çš„å°æ¡ï¼‰ -->
            <Rectangle Grid.Row="0"
                       Width="60"
                       Height="3"
                       Fill="#505050"
                       RadiusX="1.5"
                       RadiusY="1.5"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"
                       IsHitTestVisible="False"/>

            <!-- æŽ§åˆ¶æ å†…å®¹ -->
            <DockPanel Grid.Row="1"
                       Margin="8,0,8,8">

                <!-- å·¦ä¾§ï¼šå¯¼èˆªæŒ‰é’® -->
                <StackPanel DockPanel.Dock="Left"
                            Orientation="Horizontal"
                            VerticalAlignment="Center">
                    
                    <!-- åŽé€€æŒ‰é’® -->
                    <Button x:Name="BtnBack"
                            Style="{StaticResource NavButtonStyle}"
                            Command="{Binding BackCommand}"
                            ToolTip="åŽé€€">
                        <TextBlock Text="â—€" FontSize="12"/>
                    </Button>

                    <!-- å‰è¿›æŒ‰é’® -->
                    <Button x:Name="BtnForward"
                            Style="{StaticResource NavButtonStyle}"
                            Command="{Binding ForwardCommand}"
                            ToolTip="å‰è¿›">
                        <TextBlock Text="â–¶" FontSize="12"/>
                    </Button>

                    <!-- åˆ·æ–°æŒ‰é’® -->
                    <Button x:Name="BtnRefresh"
                            Style="{StaticResource NavButtonStyle}"
                            Command="{Binding RefreshCommand}"
                            ToolTip="åˆ·æ–°"
                            Margin="4,0,0,0">
                        <TextBlock Text="ðŸ”„" FontSize="12"/>
                    </Button>
                </StackPanel>

                <!-- å³ä¾§ï¼šæ”¶è—ã€å½’æ¡£å’Œèœå•æŒ‰é’® -->
                <StackPanel DockPanel.Dock="Right"
                            Orientation="Horizontal"
                            VerticalAlignment="Center">

                    <!-- æ”¶è—æŒ‰é’® -->
                    <Button x:Name="BtnBookmark"
                            Style="{StaticResource NavButtonStyle}"
                            Command="{Binding ToggleBookmarkCommand}"
                            ToolTip="æ”¶è—"
                            Margin="0,0,8,0">
                        <TextBlock Text="â˜†" FontSize="14"/>
                    </Button>

                    <!-- è®°å½•ç¬”è®°æŒ‰é’® -->
                    <Button x:Name="BtnRecordNote"
                            Style="{StaticResource NavButtonStyle}"
                            Command="{Binding RecordNoteCommand}"
                            ToolTip="è®°å½•"
                            Margin="0,0,8,0">
                        <TextBlock Text="ðŸ’¾" FontSize="14"/>
                    </Button>

                    <!-- èœå•æŒ‰é’® -->
                    <Button x:Name="BtnMenu"
                            Style="{StaticResource NavButtonStyle}"
                            Click="BtnMenu_Click"
                            ToolTip="èœå•"
                            Margin="0,0,4,0">
                        <TextBlock Text="â‰¡" FontSize="16" FontWeight="Bold"/>
                        <Button.ContextMenu>
                            <ContextMenu x:Name="MainMenu" Style="{StaticResource DarkContextMenuStyle}">
                                <MenuItem x:Name="MenuHistory" Header="ðŸ“œ åŽ†å²è®°å½•" Style="{StaticResource DarkMenuItemStyle}" Click="MenuHistory_Click"/>
                                <MenuItem x:Name="MenuBookmarks" Header="ðŸŒŸ æ”¶è—å¤¹" Style="{StaticResource DarkMenuItemStyle}" Click="MenuBookmarks_Click"/>
                                <MenuItem x:Name="MenuPioneerNotes" Header="ðŸ–Šï¸ å¼€è’ç¬”è®°" Style="{StaticResource DarkMenuItemStyle}" Click="MenuPioneerNotes_Click"/>
                                <Separator Style="{StaticResource DarkSeparatorStyle}"/>
                                <MenuItem x:Name="MenuPluginCenter" Header="ðŸ”Œ æ’ä»¶ä¸­å¿ƒ" Style="{StaticResource DarkMenuItemStyle}" Click="MenuPluginCenter_Click"/>
                                <MenuItem x:Name="MenuSettings" Header="âš™ï¸ è®¾ç½®" Style="{StaticResource DarkMenuItemStyle}" Click="MenuSettings_Click"/>
                                <MenuItem x:Name="MenuAbout" Header="â„¹ï¸ å…³äºŽ" Style="{StaticResource DarkMenuItemStyle}" Click="MenuAbout_Click"/>
                            </ContextMenu>
                        </Button.ContextMenu>
                    </Button>
                </StackPanel>

                <!-- ä¸­é—´ï¼šURL åœ°å€æ  + å‰å¾€æŒ‰é’® -->
                <Grid Margin="12,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBox x:Name="UrlTextBox"
                             Grid.Column="0"
                             Style="{StaticResource UrlTextBoxStyle}"
                             Text="{Binding CurrentUrl, UpdateSourceTrigger=PropertyChanged}"
                             KeyDown="UrlTextBox_KeyDown"
                             ToolTip="è¾“å…¥ç½‘å€åŽæŒ‰å›žè½¦å¯¼èˆª"/>

                    <!-- å‰å¾€æŒ‰é’® -->
                    <Button x:Name="BtnGo"
                            Grid.Column="1"
                            Style="{StaticResource NavButtonStyle}"
                            Command="{Binding NavigateCommand}"
                            CommandParameter="{Binding CurrentUrl}"
                            ToolTip="å‰å¾€"
                            Margin="4,0,0,0">
                        <TextBlock Text="â†’" FontSize="14" FontWeight="Bold"/>
                    </Button>
                </Grid>

            </DockPanel>
        </Grid>
    </Border>
    </Grid>
</Window>
